<!DOCTYPE HTML>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <title>Kindness</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="kindness.css" media="screen">
    <script src="https://www.gstatic.com/firebasejs/5.0.3/firebase.js"></script>
    <script>
function initFbRtDb() {
	// Set the configuration for your app
	// TODO: Replace with your project's config object
	var config = {
		apiKey: "AIzaSyCgYxcjWxlCvEAKFxAVPTn_6aNfisn_h7s",
		authDomain: "projectId.firebaseapp.com",
		databaseURL: "https://kindness-360.firebaseio.com",
		storageBucket: "kindness-360.appspot.com"
	};
	firebase.initializeApp(config);
}


function readFbRtDb() {
	// Get a reference to the database service
	var db = firebase.database();

	write('output', '');

	var cats = db.ref('/categories');
	cats.once('value', function(snapshot) {
		var categories = snapshot.val();
		for (var i = 1;  i < categories.length;  ++i) {
			var category = categories[i];
			if (category) {
				append('output', stringFromCategory(category));
			}
		}
	});

	var reports = db.ref('/reports');
	//reps.once('value', function(snapshot) {
	//	var reports = snapshot.val();
	//	for (var key in reports) {
	//		var report = reports[key];
	//		append('output', stringFromReport(report));
	//	}
	//
	//});
	reports.on(child_aded, readOneReport());
}

function readOneReport(snapshot){
	var report = snapshot.val();
	console.log(JSON.stringify(report));
}


function appendFbRtDb() {
	// Get a reference to the database service
	var db = firebase.database();

	var cat = document.getElementById("cat").value;
	console.log(cat);
	var now = new Date().getTime();
	var report = {category:cat, latitude:7.9, longitude:-1.0, timestamp:now};
	var reps = db.ref('/reports');
	var node = reps.push();
	var key = node.key;
	node.set(report, function(error) {
		if (error) {
			alert('' + error);
		}
	});

	var cats = db.ref('/categories/' + cat + '/reports/' + key);
	cats.set(true, function(error) {
		if (error) {
			alert('' + error);
		}
	});
}


function stringFromCategory(category) {
	return category.name + ' ' + Object.keys(category.reports).length;
}


function stringFromReport(report) {
	return JSON.stringify(report);
}


function write(id, msg) {
	document.getElementById(id).innerHTML = msg + '<br>';
}

function append(id, msg) {
	document.getElementById(id).innerHTML += msg + '<br>';
}
	</script>

</head>

<body onload="initFbRtDb()">
<div id="map"></div>
<script>
		 // Initialize and add the map
function initMap() {
  // The location of Uluru
  var rexburg = {lat: 43.82  , lng: -111.742};
  // The map, centered at rexburg
  var map = new google.maps.Map(
      document.getElementById('map'), {zoom: 4, center: rexburg});
  // The marker, positioned at rexburg
  var marker = new google.maps.Marker({position: rexburg, map: map});
}
    </script>
<!--Load the API from the specified URL
* The async attribute allows the browser to render the page while the API loads
* The key parameter will contain your own API key (which is not needed for this tutorial)
* The callback parameter executes the initMap() function
-->
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCgYxcjWxlCvEAKFxAVPTn_6aNfisn_h7s&callback=initMap">
</script>
<h2>Kindness Map</h2>
<form>
        <label>Report the Act of kindness that you saw</label><br>
        <select id="cat">
            <option value="1">Gifts</option>
            <option value="2">Service</option>
            <option value="3">Time</option>
            <option value="4">Touch</option>
            <option value="5">Words</option>
        </select><br>
<button type="button" onclick="appendFbRtDb()">Add</button>
<form></form>
<button type="button" onclick="readFbRtDb()">Read</button>
<div id="output"></div>
</body>
</html>
